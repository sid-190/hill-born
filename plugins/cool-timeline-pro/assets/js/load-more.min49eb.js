jQuery((function($){function ctlStoryAnimation_loadMore(){$(".cooltimeline_cont").each((function(index){var timeline_id=$(this).attr("id"),animations;"none"!=$("#"+timeline_id).attr("data-animations")&&AOS.init({disable:"mobile",startEvent:"DOMContentLoaded",offset:75,delay:0,duration:750,easing:"ease-in-out-sine",mirror:!0})}))}var loading=!1,timelineWrapper;1==$(".cool_timeline").find(".ctl_load_more").attr("data-max-num-pages")?$(".cool_timeline").find(".ctl_load_more").hide():naviLoadMoreBtn($(".cool_timeline"));function ctlCompactSettings($grid){null!=($grid=$(".clt-compact-cont"))&&($grid.masonry("reloadItems"),$grid.imagesLoaded((function(){$grid.masonry("layout")})),$grid.one("layoutComplete",(function(){var leftPos=0,topPosDiff;$grid.find(".timeline-mansory").each((function(index){(leftPos=$(this).position().left)<=0?$(this).removeClass("ctl-right").addClass("ctl-left"):$(this).removeClass("ctl-left").addClass("ctl-right"),(topPosDiff=$(this).position().top-$(this).prev().position().top)<40&&($(this).find(".timeline-icon").removeClass("compact-iconup").addClass("compact-icondown"),$(this).prev().find(".timeline-icon").removeClass("compact-icondown").addClass("compact-iconup"),$(this).find(".content-title").removeClass("compact-afterup").addClass("compact-afterdown"),$(this).prev().find(".content-title").removeClass("compact-afterdown").addClass("compact-afterup"),$(this).find(".timeline-content").removeClass("compact-afterup").addClass("compact-afterdown"),$(this).prev().find(".timeline-content").removeClass("compact-afterdown").addClass("compact-afterup"))})),$(".timeline-icon").addClass("showit"),$(".content-title").addClass("showit-after");var timeline_id=jQuery(".cooltimeline_cont").attr("id"),animations;"none"!=jQuery("#"+timeline_id).attr("data-animations")&&AOS.refreshHard()})))}function enableStoryPopup(timeline_wrp){null!=timeline_wrp&&(timeline_wrp.find("a[class^='ctl_prettyPhoto']").prettyPhoto({social_tools:!1}),timeline_wrp.find("a[rel^='ctl_prettyPhoto']").prettyPhoto({social_tools:!1}),$(".cool_timeline").find("a[ref^='prettyPhoto']").prettyPhoto({social_tools:!1,show_title:!1,changepicturecallback:function(){initialize()},callback:function(){unInitialize()}}))}function storySlideShow(container){container.find(".ctl_flexslider .slides").not(".slick-initialized").each((function(){$(this).find("a[class^='ctl_prettyPhoto']").prettyPhoto({social_tools:!1,show_title:!1});var autoplaySpeed=parseInt($(this).data("animationspeed")),slideshow=$(this).data("slideshow");if($(this).parents(".cool-timeline").hasClass("compact"))var autoHeight=!1;else var autoHeight=!0;$(this).slick({dots:!1,infinite:!1,arrows:!0,mobileFirst:!0,pauseOnHover:!0,slidesToShow:1,autoplay:slideshow,autoplaySpeed:autoplaySpeed,adaptiveHeight:autoHeight})}))}function naviLoadMoreBtn(parent_wrp){parent_wrp.find(".ctl_load_more").length&&$("body").find(".ctl-bullets-container ul li").length&&parent_wrp.find(".ctl_load_more").each((function(){var loadMoreBtn=$(this),timelineId=loadMoreBtn.parents(".cool_timeline").attr("id"),naviContainer=$("#"+timelineId+"-navi"),buttonHtml='<button data-text="..Loading" class="ctl_load_more_clone">Load More</button>';naviContainer.find("ul").after(buttonHtml),naviContainer.find(".ctl_load_more_clone").on("click",(function(){var text=$(this).data("text");$(this).text(text),loadMoreBtn.trigger("click")}))}))}function initialize(){$(".ctl_popup_slick .slides").each((function(){$(this).slick({dots:!1,infinite:!1,slidesToShow:1,autoplay:!1,autoplaySpeed:2e3,adaptiveHeight:!0})}))}function unInitialize(){$(".ctl_popup_slick .slides").each((function(){$(this).slick("unslick")}))}function storyYearNavigation(timeline_wrp){if(null!=timeline_wrp){var wrp_id=timeline_wrp.attr("id");$("#"+wrp_id+"-navi").remove();var pagination=timeline_wrp.attr("data-pagination"),pagination_position=timeline_wrp.attr("data-pagination-position"),bull_cls="",position="";"left"==pagination_position?(bull_cls="section-bullets-left",position="left"):"right"==pagination_position?(bull_cls="section-bullets-right",position="right"):"bottom"==pagination_position&&(bull_cls="section-bullets-bottom",position="bottom"),$("body").sectionScroll({bulletsClass:bull_cls,sectionsClass:"scrollable-section",scrollDuration:1500,titles:!0,topOffset:2,easing:"",id:wrp_id,position:position})}}$(".ctl_load_more").attr("data_current_page",2),$("body").on("click",".ctl_load_more",(function(){var timeline_wrp=$(this).parents(".cool_timeline"),wrp_id=timeline_wrp.attr("id"),UID=wrp_id.charAt(wrp_id.length-2)+wrp_id.charAt(wrp_id.length-1);if(UID=UID.replace("-",""),wrp_id.startsWith("content"))var shortcode_type="content-timeline",ajax_action="ct_ajax_load_more",ctlloadmore=window["ct_load_more_"+UID];else var shortcode_type="story-timeline",ajax_action="ctl_ajax_load_more",ctlloadmore=window["ctlloadmore_"+UID];var org_label=$(this).text(),loading_text=$(this).attr("data-loading-text"),button=timeline_wrp.find(".ctl_load_more"),type=$(this).attr("data-timeline-type"),last_year=timeline_wrp.find(".timeline-year:last").data("section-title");if("compact"==type)var last_year=timeline_wrp.find(".compact-year:last").data("section-title");else var last_year=timeline_wrp.find(".timeline-year:last").data("section-title");var allAtts=ctlloadmore.attribute,alternate=timeline_wrp.find(".timeline-post:last").data("alternate");if($(".ct-cat-filters").length&&$(".ct-cat-filters").hasClass("active-category")){var filterCat=$(".active-category").data("term-slug");allAtts.category=filterCat}if(!loading){$(this).html(loading_text);var max_pages=$(this).attr("data-max-num-pages"),max_page_num=parseInt(max_pages)+1;loading=!0;var request_page=$(this).attr("data_current_page"),data={action:ajax_action,page:request_page,last_year:last_year,alternate:alternate,attribute:allAtts,nonce:ctlloadmore.nonce};$.post(ctlloadmore.url,data,(function(res){if(res.success){var $grid;if("compact"==type)ctlCompactSettings(timeline_wrp.find(".clt-compact-cont .timeline-post").last().after(res.data));else timeline_wrp.find(".cooltimeline_cont").append(res.data);storyYearNavigation(timeline_wrp),enableStoryPopup(timeline_wrp),"story-timeline"==shortcode_type&&storySlideShow(timeline_wrp),naviLoadMoreBtn(timeline_wrp),ctlStoryAnimation_loadMore(),button.html(org_label);var next_page=parseInt(request_page)+1;button.attr("data_current_page",next_page),loading=!1,next_page>=max_page_num&&(button.hide(),$("#"+wrp_id+"-navi").find(".ctl_load_more_clone").hide())}})).fail((function(xhr,textStatus,e){console.log(xhr.responseText)}))}})),$(".ct-cat-filters").on("click",(function($event){$event.preventDefault(),$(".ctl_load_more").attr("data_current_page",2);var timeline_wrp,wrp_id=$(this).parents(".cool_timeline").attr("id"),UID=wrp_id.charAt(wrp_id.length-2)+wrp_id.charAt(wrp_id.length-1);if(UID=UID.replace("-",""),wrp_id.startsWith("content"))var shortcode_type="content-timeline",ajax_action="ct_ajax_load_more",ctlloadmore=window["ct_load_more_"+UID];else var shortcode_type="story-timeline",ajax_action="ctl_ajax_load_more",ctlloadmore=window["ctlloadmore_"+UID];$(".cat-filter-wrp ul li a").removeClass("active-category"),$(this).addClass("active-category");var cat_name=$(this).text(),parent_wrp=$(this).parents(".cool_timeline"),preloader=parent_wrp.find(".filter-preloaders");preloader.show();var parent_id,navigation="#"+parent_wrp.attr("id")+"-navi",termSlug=$(this).data("term-slug"),totalPosts=parseInt($(this).data("post-count")),action=$(this).data("action"),tm_type=$(this).data("tm-type"),type=$(this).data("type"),loading=!1,org_label=$(this).text(),loading_text=$(this).attr("data-loading-text");if("compact"==type)var last_year=parent_wrp.find(".compact-year:last").data("section-title");else var last_year=parent_wrp.find(".timeline-year:last").data("section-title");var alternate=parent_wrp.find(".timeline-post:last").data("alternate"),all_attrs=ctlloadmore.attribute,ajax_url=ctlloadmore.url,nonce=ctlloadmore.nonce,showPosts=$(".cool-timeline-wrapper").attr("data-showposts"),countPages=Math.ceil(totalPosts/showPosts);if($(".ctl_load_more").attr("data-max-num-pages",countPages),page=2,totalPosts>showPosts?$(this).parents(".cool_timeline").find(".ctl_load_more").show():$(this).parents(".cool_timeline").find(".ctl_load_more").hide(),all_attrs.category=termSlug,!loading){"compact"==type?parent_wrp.find(".clt-compact-cont").html(" "):parent_wrp.find(".cooltimeline_cont").html(" "),loading=!0;var data={action:action,last_year:last_year,alternate:alternate,termslug:termSlug,attribute:all_attrs,nonce:nonce};$.post(ajax_url,data,(function(res){if("string"==typeof res&&"undefined"!=res&&(res=JSON.parse(res)),res.success){var $grid;if("compact"==type)if(void 0!==res.data&&""!=res.data)parent_wrp.find(".clt-compact-cont").append('<div class="center-line"></div>'),ctlCompactSettings(parent_wrp.find(".clt-compact-cont").append(res.data)),parent_wrp.find(".ctl_load_more").removeClass("clt-hide-it");else parent_wrp.find(".ctl_load_more").addClass("clt-hide-it");else void 0!==res.data&&""!=res.data?(parent_wrp.find(".cooltimeline_cont").append(res.data),parent_wrp.find(".ctl_load_more").removeClass("clt-hide-it")):parent_wrp.find(".ctl_load_more").addClass("clt-hide-it");loading=!1,preloader.hide(),$(parent_wrp).find(".timeline-main-title").text(cat_name),$(parent_wrp).find(".no-content").hide(),storyYearNavigation(parent_wrp),enableStoryPopup(parent_wrp),storySlideShow(parent_wrp),naviLoadMoreBtn(parent_wrp);var timeline_id=jQuery(".cooltimeline_cont").attr("id"),animations;"none"!=jQuery("#"+timeline_id).attr("data-animations")&&AOS.refreshHard()}})).fail((function(xhr,textStatus,e){console.log(xhr.responseText)}))}}))}));